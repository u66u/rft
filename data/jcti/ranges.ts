type AgeRange = {
  min: number; // age in months
  max: number;
  scores: number[]; // index = raw score, value = reference score
};

export const JCTIscoreRanges: AgeRange[] = [
  {
    min: 60, // 5:0
    max: 161, // 13:5
    scores: [
      82, 85, 88, 91, 94, 96, 98, 100, 102, 106, 108, 111, 113, 116, 118, 120,
      122, 123, 125, 126, 128, 129, 132, 133, 135, 136, 137, 138, 139, 140, 141,
      142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 154, 155, 157, 160,
      163, 165, 168, 170, 170, 170, 170,
    ],
  },
  {
    min: 162, // 13:6
    max: 173, // 14:5
    scores: [
      76, 79, 82, 85, 88, 90, 92, 94, 96, 99, 102, 105, 107, 110, 112, 114, 116,
      117, 119, 120, 122, 123, 125, 126, 128, 129, 130, 131, 132, 133, 134, 135,
      136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 147, 148, 150, 152, 155,
      157, 160, 164, 170, 170, 170,
    ],
  },
  {
    min: 174, // 14:6
    max: 185, // 15:5
    scores: [
      73, 76, 79, 82, 85, 87, 89, 91, 93, 96, 98, 101, 103, 106, 108, 110, 112,
      113, 115, 116, 118, 119, 121, 122, 124, 125, 126, 127, 128, 129, 130, 131,
      132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 143, 144, 146, 148, 151,
      153, 156, 159, 165, 170, 170,
    ],
  },
  {
    min: 186, // 15:6
    max: 197, // 16:5
    scores: [
      70, 73, 76, 79, 82, 84, 86, 88, 90, 93, 94, 97, 99, 102, 104, 106, 108,
      109, 111, 112, 114, 115, 117, 118, 120, 121, 122, 123, 124, 125, 126, 127,
      128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 139, 140, 142, 144, 147,
      149, 152, 155, 161, 170, 170,
    ],
  },
  {
    min: 198, // 16:6
    max: 209, // 17:5
    scores: [
      67, 70, 73, 76, 79, 81, 83, 85, 87, 90, 92, 95, 97, 100, 102, 104, 106,
      107, 109, 110, 112, 113, 115, 116, 118, 119, 120, 121, 122, 123, 124, 125,
      126, 127, 128, 129, 130, 130, 131, 132, 133, 134, 136, 137, 139, 141, 144,
      146, 149, 152, 158, 167, 170,
    ],
  },
  {
    min: 210, // 17:6
    max: 221, // 18:5
    scores: [
      65, 68, 71, 74, 77, 79, 81, 83, 85, 88, 90, 93, 95, 98, 100, 102, 104,
      105, 107, 108, 110, 111, 113, 114, 116, 117, 118, 119, 120, 121, 122, 123,
      124, 125, 126, 127, 128, 128, 129, 130, 131, 132, 134, 135, 137, 139, 142,
      144, 147, 150, 156, 165, 170,
    ],
  },
  {
    min: 222, // 18:6
    max: 233, // 19:5
    scores: [
      64, 67, 70, 73, 76, 78, 80, 82, 84, 87, 88, 91, 93, 96, 98, 100, 102, 103,
      105, 106, 108, 109, 111, 112, 114, 115, 116, 117, 118, 119, 120, 121, 122,
      123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 135, 137, 140, 142,
      145, 148, 154, 163, 170,
    ],
  },
  {
    min: 234, // 19:6
    max: 299, // 24:11
    scores: [
      63, 66, 69, 72, 75, 77, 78, 80, 82, 85, 87, 90, 92, 95, 97, 99, 101, 102,
      104, 105, 107, 108, 110, 111, 113, 114, 115, 116, 117, 118, 119, 120, 120,
      121, 122, 123, 124, 125, 126, 127, 128, 129, 131, 132, 134, 136, 139, 141,
      144, 147, 153, 162, 170,
    ],
  },
  {
    min: 300, // 25:0
    max: 359, // 29:11
    scores: [
      60, 63, 66, 69, 72, 74, 76, 78, 80, 83, 85, 88, 90, 93, 95, 97, 99, 100,
      102, 103, 104, 105, 107, 108, 110, 111, 112, 113, 114, 115, 116, 117, 118,
      119, 120, 121, 122, 123, 124, 125, 126, 127, 129, 130, 132, 134, 137, 139,
      142, 145, 151, 160, 170,
    ],
  },
  {
    min: 360, // 30:0
    max: 419, // 34:11
    scores: [
      60, 63, 66, 69, 72, 74, 76, 78, 80, 83, 85, 88, 90, 93, 95, 97, 99, 100,
      102, 103, 105, 106, 108, 109, 112, 113, 114, 115, 116, 117, 118, 119, 120,
      121, 122, 123, 124, 125, 126, 127, 128, 129, 131, 132, 134, 136, 139, 141,
      144, 147, 153, 162, 170,
    ],
  },
  {
    min: 420, // 35:0
    max: 539, // 44:11
    scores: [
      62, 65, 68, 71, 74, 76, 78, 80, 82, 85, 87, 90, 92, 95, 97, 99, 101, 102,
      104, 105, 107, 108, 110, 111, 113, 114, 115, 116, 117, 118, 119, 120, 120,
      121, 122, 123, 124, 125, 126, 127, 128, 129, 131, 132, 134, 136, 139, 141,
      144, 147, 153, 162, 170,
    ],
  },
  {
    min: 540, // 45:0
    max: 623, // 51:11
    scores: [
      64, 67, 70, 73, 76, 78, 80, 82, 84, 86, 88, 91, 93, 96, 98, 100, 102, 103,
      105, 106, 108, 109, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121,
      122, 123, 124, 125, 126, 127, 128, 129, 130, 132, 133, 135, 137, 140, 141,
      144, 147, 153, 162, 170,
    ],
  },
  {
    min: 624, // 52:0
    max: 683, // 56:11
    scores: [
      69, 72, 75, 78, 81, 82, 84, 86, 88, 91, 93, 96, 98, 101, 103, 105, 106,
      107, 109, 110, 112, 113, 115, 116, 118, 119, 120, 121, 122, 123, 124, 125,
      126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 137, 138, 140, 142, 145,
      147, 150, 153, 159, 168, 170,
    ],
  },
  {
    min: 684, // 57:0
    max: 755, // 62:11
    scores: [
      90, 93, 96, 99, 102, 104, 106, 108, 110, 113, 115, 118, 120, 123, 125,
      127, 129, 130, 132, 133, 135, 136, 138, 139, 141, 142, 143, 144, 145, 146,
      147, 148, 149, 150, 151, 152, 153, 154, 154, 155, 156, 157, 159, 160, 162,
      164, 167, 169, 170, 170, 170, 170, 170,
    ],
  },
  {
    min: 756, // 63:0
    max: 12000, // arbitrary upper limit
    scores: [
      77, 80, 83, 86, 90, 92, 94, 96, 99, 102, 104, 107, 110, 113, 115, 117,
      120, 121, 123, 124, 126, 127, 129, 131, 133, 134, 135, 136, 137, 138, 139,
      141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 152, 154, 155, 157, 159,
      163, 165, 168, 170, 170, 170, 170,
    ],
  },
];

export function getJCTIscore(ageInMonths: number, rawScore: number): number {
  const ageRange = JCTIscoreRanges.find(
    (range) => ageInMonths >= range.min && ageInMonths <= range.max,
  );

  if (!ageRange) {
    throw new Error("Age out of range");
  }

  const score = ageRange.scores[rawScore];
  if (score === undefined) {
    throw new Error("Raw score out of range");
  }
  return score;
}
